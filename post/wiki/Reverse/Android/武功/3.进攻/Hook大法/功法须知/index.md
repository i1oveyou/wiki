---
title: wiki-Reverse-Android-武功-Hook大法-功法须知
---
# 什么是 Hook

Hook 又叫“钩子”，它可以在事件传送的过程中截获并监控事件的传输，将自身的代码与系统方法进行融入

这样当这些方法被调用时，也就可以执行我们自己的代码，这也是面向切面编程的思想（AOP）



# Hook 分类



1）根据Android开发模式，Native模式（C/C++）和Java模式（Java）区分，在Android平台上

- Java层级的Hook
- Native层级的Hook



2）根 Hook 对象与 Hook 后处理事件方式不同，Hook还分为：

- 消息Hook
- API Hook



3）针对Hook的不同进程上来说，还可分为：

- 全局Hook
- 单个进程Hook

# Hook原理

Hook技术本质是函数调用，由于处于Linux用户状态，每个进程有自己独立的进程控件，所以必须先注入所要Hook的进程空间，修改其内存中进程代码，替换过程表的符号地址，通过ptrace函数附加进程，向远程进程注入so库，从而达到监控以及远程进程关键函数挂钩

Hook工作流程：

- Android相关内核函数：

- - ptrace函数：跟踪一个目标进程，结束跟踪一个目标进程，获取内存字节，像内存写入地址
  - dlopen函数：以指定模式打开指定的动态链接库文件
  - mmap函数：分配一段临时的内存来完成代码的存放

- 向目标进程注入代码总结后的步骤分为以下几步：

- - 用ptrace函数attch上目标进程
  - 发现装载共享库so函数
  - 装载指定的.so
  - 让目标进程的执行流程跳转到注入的代码执行
  - 