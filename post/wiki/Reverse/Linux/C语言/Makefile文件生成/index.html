<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="script.js"></script> -->
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>
    <meta name="generator" content="pandoc" />
  <title>wiki-Reverse-elfRe-C语言-Makefile文件生成</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">wiki-Reverse-elfRe-C语言-Makefile文件生成</span>
        <ul class="nav pull-right doc-info">
                            </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div id="TOC" class="span3">
        <div class="well toc">

        <ul>
        <li><a href="#杂七杂八" id="toc-杂七杂八">杂七杂八</a></li>
        <li><a href="#如何生出静态链接库和动态链接库"
        id="toc-如何生出静态链接库和动态链接库">如何生出静态链接库和动态链接库</a>
        <ul>
        <li><a href="#静态库" id="toc-静态库">静态库</a></li>
        <li><a href="#动态库" id="toc-动态库">动态库</a></li>
        </ul></li>
        <li><a href="#helloworld"
        id="toc-helloworld">helloworld</a></li>
        <li><a href="#伪目标" id="toc-伪目标">伪目标</a></li>
        <li><a href="#变量的引用"
        id="toc-变量的引用">变量的引用</a></li>
        <li><a href="#预定义的变量"
        id="toc-预定义的变量">预定义的变量</a></li>
        <li><a href="#makefile常见的符号"
        id="toc-makefile常见的符号">makefile常见的符号</a>
        <ul>
        <li><a href="#section" id="toc-section">=</a></li>
        <li><a href="#section-1" id="toc-section-1">:=</a></li>
        <li><a href="#section-2" id="toc-section-2">?=</a></li>
        <li><a href="#section-3" id="toc-section-3">+=</a></li>
        <li><a href="#section-4" id="toc-section-4"><br />
        </a></li>
        </ul></li>
        <li><a href="#基本函数" id="toc-基本函数">基本函数</a>
        <ul>
        <li><a href="#shell" id="toc-shell">shell</a></li>
        <li><a href="#subst-patsubst" id="toc-subst-patsubst">subst
        ,patsubst</a></li>
        <li><a href="#foreach" id="toc-foreach">foreach</a></li>
        <li><a href="#dir-not-dir" id="toc-dir-not-dir">dir,
        not-dir</a></li>
        <li><a href="#filter-basename-filter-out"
        id="toc-filter-basename-filter-out">filter, basename ,
        filter-out</a></li>
        <li><a href="#section-5" id="toc-section-5">$(%)</a></li>
        </ul></li>
        <li><a href="#进入正题" id="toc-进入正题">进入正题</a></li>
        <li><a href="#gcc-一些编译选项" id="toc-gcc-一些编译选项">gcc
        一些编译选项</a></li>
        <li><a href="#带头文件的编译"
        id="toc-带头文件的编译">带头文件的编译</a></li>
        </ul>

        </div>
      </div>
            <div class="span9">

      
      <h1 id="杂七杂八">杂七杂八</h1>
<p>gcc 肯定有默认的文件搜索路径的, 下面的指令是可以查看的</p>
<pre><code>echo | gcc -v -x c -E -</code></pre>
<p>如果我们需要把C语言转化为汇编语言,,,就那种纯汇编的文件</p>
<pre><code>gcc -S xx.c -o yy.asm</code></pre>
<p>那么最后xx.c就会被翻译为汇编语言</p>
<p>为什么要这么干?
万一以后,,我们学了linux汇编语言的时候,,我们就可以写c,然后翻译为汇编,,,然后参考它的语法</p>
<h1
id="如何生出静态链接库和动态链接库">如何生出静态链接库和动态链接库</h1>
<p>.a 静态库文件</p>
<p>.i 是预处理文件</p>
<p>.s 是汇编代码文件</p>
<p>.o 类似于obj文件</p>
<p>.so 类似于dll文件</p>
<p>关于库名,有一个约定俗成的名字,,那就是<code>libXXX.so或者libYYY.a</code></p>
<h2 id="静态库">静态库</h2>
<p>main.c</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sub<span class="op">(</span><span class="dt">int</span><span class="op">,</span><span class="dt">int</span><span class="op">);</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span><span class="op">,</span><span class="dt">int</span><span class="op">);</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">=</span><span class="dv">70</span><span class="op">,</span>y<span class="op">=</span><span class="dv">20</span><span class="op">,</span>z<span class="op">;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    z<span class="op">=</span>add<span class="op">(</span>x<span class="op">,</span>y<span class="op">);</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;a+b=</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span>z<span class="op">);</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    z<span class="op">=</span>sub<span class="op">(</span>x<span class="op">,</span>y<span class="op">);</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;a-b=</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span>z<span class="op">);</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>func_sub.c</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sub<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span><span class="dt">int</span> y<span class="op">){</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">+</span>y<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>func_add.c</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span><span class="dt">int</span> y<span class="op">){</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x<span class="op">+</span>y<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>我们把<code>func_sub.c和func_add.c</code>整合为一个静态库</p>
<p>然后哦main.c和静态库链接在一起</p>
<pre><code>gcc -c func_add.c func_sub.c    //生成.o
ar -r func.a func_add.o func_sub.o  //生成静态库
gcc main.c libfunc.a -o main.elf    //链接</code></pre>
<h2 id="动态库">动态库</h2>
<pre><code>gcc -c -fpic func_add.c func_sub.c
gcc -shared func_add.o func_sub.o -o func.so</code></pre>
<p>在链接过程中一直遇到问题,,woc</p>
<pre><code> gcc main.c  -L./ -l./func.so -Wl,-rpath=./</code></pre>
<h1 id="helloworld">helloworld</h1>
<figure>
<img src="img/image-20231014154327477.png"
alt="image-20231014154327477" />
<figcaption aria-hidden="true">image-20231014154327477</figcaption>
</figure>
<p>最简单的makefile</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dv">main:</span><span class="dt">main.c</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc main.c -o main.elf</span></code></pre></div>
<p>执行make</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make
gcc main.c -o main.elf</code></pre>
<p>其中,make会在当前路径搜索<code>makefile或者Makefile</code>文件进行make操作</p>
<p>如果要指定文件进行make操作的话,,,就需要<code>make -f xxx</code></p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ ./main.elf
hello world</code></pre>
<h1 id="伪目标">伪目标</h1>
<p>为什么叫伪目标?</p>
<p>因为最后的目标只有一个? 其它的都是假的???</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm -rf *.o</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>echo hello</span></code></pre></div>
<p>尝试运行</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
echo hello
hello
redqx@DebianYY:/mnt/hgfs/share/demo$ make clean
rm -rf *.o
redqx@DebianYY:/mnt/hgfs/share/demo$ </code></pre>
<p>发现我们执行的指令也输出了….</p>
<p>我们可以隐藏我们的指令,,而只是输出结果,在指令前面加上<code>@</code></p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">rm -rf *.o</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo redqx</span></span></code></pre></div>
<p>运行如下</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
redqx
redqx@DebianYY:/mnt/hgfs/share/demo$ make clean
redqx@DebianYY:/mnt/hgfs/share/demo$ </code></pre>
<p>说一下我们遇到的<code>.PHONY</code>指令</p>
<p>这个的线就是告诉我们的make,,我们将要执行的名称不是文件,,而是指令</p>
<pre><code>make clean</code></pre>
<p>比如clean是一个指令,,而不是文件</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">rm -rf objs</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo redqx</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">clean,debug</span></span></code></pre></div>
<p>还有就是这目标的字符串名字可以任意指定,,但是最好是符合规范的,同时也有一些隐晦的规则用于目标名</p>
<p>此外，还有一些约定俗成的目标名：</p>
<ul>
<li><code>all</code>：通常用于指定默认的目标，表示编译或构建所有的目标。</li>
<li><code>clean</code>：用于删除生成的文件，清理项目目录。</li>
<li><code>install</code>：用于将已编译的程序文件安装到指定的位置。</li>
<li><code>test</code>：用于运行测试脚本、执行测试用例等。</li>
<li><code>doc</code>：用于生成项目文档。</li>
</ul>
<h1 id="变量的引用">变量的引用</h1>
<div class="sourceCode" id="cb18"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">INCS</span> <span class="ch">:=</span><span class="st"> /mnt/hgfs/share/demo/inc</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span> <span class="ch">:=</span><span class="st"> /mnt/hgfs/share/demo/src</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">INCS</span><span class="ch">)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug</span></span></code></pre></div>
<p>尝试运行</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
/mnt/hgfs/share/demo/inc
/mnt/hgfs/share/demo/src</code></pre>
<h1 id="预定义的变量">预定义的变量</h1>
<p>在看别人写的Makefile文件时，你可能会碰到以下三个变量：现在看不懂没关系,,以后再细细的介绍</p>
<pre><code>$@，$^，$&lt;</code></pre>
<p>代表的意义分别是：</p>
<ul>
<li><code>$@</code>: 目标(target)的完整名称</li>
<li><code>$&lt;</code>: 第一个依赖文件（prerequisties）的名称</li>
<li><code>$^</code>:
所有的依赖文件（prerequisties），以空格分开，不包含重复的依赖文件</li>
</ul>
<p>所以<code>$&lt;</code>就是<code>$^</code>的第一个</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find src -name *.c</span><span class="ch">)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">patsubst</span><span class="st"> src/%.c</span><span class="kw">,</span><span class="st">obj/%.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">))</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="dv">obj/%.o :</span><span class="dt">src/%.c</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo ++++</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$^</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$@</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$&lt;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="dv">compile:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">)</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug compile</span></span></code></pre></div>
<p>运行如下</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make compile
++++
src/add.c
obj/add.o
src/add.c
++++
src/main.c
obj/main.o
src/main.c
++++
src/sub.c
obj/sub.o
src/sub.c</code></pre>
<p>其中可以看到,,,其实%就像是一个遍历,,一个一个的取出数据来</p>
<h1 id="makefile常见的符号">makefile常见的符号</h1>
<h2 id="section">=</h2>
<ul>
<li>简单的赋值运算符</li>
<li>用于将右边的值分配给左边的变量</li>
<li>如果在后面的语句中重新定义了该变量，则将使用新的值</li>
</ul>
<div class="sourceCode" id="cb23"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="dt">HOST_ARCH</span><span class="ch">=</span><span class="st"> amd64</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET_ARCH</span> <span class="ch">=$(</span><span class="dt">HOST_ARCH</span><span class="ch">)</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#....</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#...</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="dt">HOST_ARCH</span> <span class="ch">=</span><span class="st"> i386</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">TARGET_ARCH</span><span class="ch">)</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug</span></span></code></pre></div>
<p>尝试运行</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
i386</code></pre>
<p>可以看到输出的是i386,而不是amd64</p>
<p>因为等号会追踪变量的最新value,然后赋值进去</p>
<h2 id="section-1">:=</h2>
<p>最朴素的等号,,,也就是我们常见的那个数学等号,,不多说</p>
<pre><code>HOST_ARCH = amd64
TARGET_ARCH := $(HOST_ARCH)

#....

#...

HOST_ARCH = i386
debug:
    @echo $(TARGET_ARCH)
    
.PHONY :debug</code></pre>
<p>尝试运行</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
amd64</code></pre>
<h2 id="section-2">?=</h2>
<p>如果该变量已经定义，则不进行任何操</p>
<p>如果该变量尚未定义，则求值并分配</p>
<p>类似于</p>
<pre><code>#ifndef
    #define xxxx
#endif</code></pre>
<div class="sourceCode" id="cb28"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET_ARCH</span> <span class="ch">=</span><span class="st"> amd64</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="dt">TARGET_ARCH</span> <span class="ch">?=</span><span class="st">i386</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">TARGET_ARCH</span><span class="ch">)</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug</span></span></code></pre></div>
<p>尝试运行</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
amd64</code></pre>
<h2 id="section-3">+=</h2>
<p>字符串的一类累加…用空格来作为分隔符</p>
<pre><code>TARGET_ARCH = amd64
TARGET_ARCH +=i386
debug:
    @echo $(TARGET_ARCH)
    
.PHONY :debug</code></pre>
<p>尝试运行</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
amd64 i386</code></pre>
<h2 id="section-4"><br />
</h2>
<p>续行符号</p>
<p>其实就是一行写不下,,然后换一行</p>
<h1 id="基本函数">基本函数</h1>
<p>函数的调用,需要使用符号<code>$</code>,,类似于变量的引用</p>
<pre><code>$(func,argv) 或者${func,argv}</code></pre>
<h2 id="shell">shell</h2>
<p>写对运行在makefile中写入shell指令</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find ./src -name *.c</span><span class="ch">)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">)</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug</span></span></code></pre></div>
<p>运行如下</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
./src/main.c</code></pre>
<h2 id="subst-patsubst">subst ,patsubst</h2>
<p>用于字符串的操作</p>
<pre><code>$(subst &lt;from&gt;,&lt;to&gt;,&lt;text&gt;)</code></pre>
<p>把text的字符串从<code>&lt;from&gt;</code>的形式转变为<code>&lt;to&gt;</code>的形式</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find ./src -name *.c</span><span class="ch">)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">subst</span><span class="st"> src/</span><span class="kw">,</span><span class="st">obj/</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">))</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">subst</span><span class="st"> .c</span><span class="kw">,</span><span class="st">.o</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">))</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">)</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug</span></span></code></pre></div>
<p>运行</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
./src/add.c ./src/main.c ./src/sub.c
./obj/add.o ./obj/main.o ./obj/sub.o</code></pre>
<pre><code>$(patsubst &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;)</code></pre>
<p>这个指令是上一个指令的升级版本</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find ./src -name *.c</span><span class="ch">)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">patsubst</span><span class="st"> %.c</span><span class="kw">,</span><span class="st">%.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">))</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug</span></span></code></pre></div>
<p>运行如下</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
./src/add.c ./src/main.c ./src/sub.c
./src/add.o ./src/main.o ./src/sub.o</code></pre>
<h2 id="foreach">foreach</h2>
<pre><code>$(foreach &lt;var&gt;,&lt;list&gt;,&lt;text&gt;)</code></pre>
<ul>
<li>名称：循环函数——foreach。</li>
<li>功能：把字串<code>&lt;list&gt;</code>中的元素逐一取出来，执行<code>&lt;text&gt;</code>包含的表达式</li>
<li>返回：<code>&lt;text&gt;</code>所返回的每个字符串所组成的整个字符串（以空格分隔）</li>
<li>var作为list取出的单个成员</li>
</ul>
<div class="sourceCode" id="cb42"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="dt">include_path</span> <span class="ch">:=</span><span class="st"> func_add_inc func_sub_inc</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="dt">INCS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">foreach</span><span class="st"> item</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">include_path</span><span class="ch">)</span><span class="kw">,</span><span class="st">-I</span><span class="ch">$(</span><span class="dt">item</span><span class="ch">))</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">include_path</span><span class="ch">)</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">INCS</span><span class="ch">)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug</span></span></code></pre></div>
<p>运行如下</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
func_add_inc func_sub_inc
-Ifunc_add_inc -Ifunc_sub_inc
redqx@DebianYY:/mnt/hgfs/share/demo$ </code></pre>
<p>当然..也可以用其它的来做一个等效</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="dt">include_path</span> <span class="ch">:=</span><span class="st"> func_add_inc func_sub_inc</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="dt">INCS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">include_path</span><span class="kw">:</span><span class="ss">%</span><span class="kw">=</span><span class="ss">-I%</span><span class="ch">)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">include_path</span><span class="ch">)</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">INCS</span><span class="ch">)</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug</span></span></code></pre></div>
<p>一样输出</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ make debug
func_add_inc func_sub_inc
-Ifunc_add_inc -Ifunc_sub_inc
redqx@DebianYY:/mnt/hgfs/share/demo$ </code></pre>
<h2 id="dir-not-dir">dir, not-dir</h2>
<p>用于创建一些没有的目录</p>
<pre><code>$(dir &lt;names...&gt;)</code></pre>
<figure>
<img src="img/image-20231014172547097.png"
alt="image-20231014172547097" />
<figcaption aria-hidden="true">image-20231014172547097</figcaption>
</figure>
<p>not-dir的意思就是把参数的路径都去掉…留下尾部的文件</p>
<p>我们尝试取出指定path的所有文件</p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find /usr/lib -name lib*</span><span class="ch">)</span><span class="st"> </span><span class="co">#输出 所有的path/file</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">:=$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIBS</span><span class="ch">))</span><span class="st">  </span><span class="co">#输出所有的 file</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">LIBS</span><span class="ch">)</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug  </span></span></code></pre></div>
<p>输出所有的/path/file</p>
<figure>
<img src="img/image-20231014173942751.png"
alt="image-20231014173942751" />
<figcaption aria-hidden="true">image-20231014173942751</figcaption>
</figure>
<p>只输出file</p>
<figure>
<img src="img/image-20231014174003391.png"
alt="image-20231014174003391" />
<figcaption aria-hidden="true">image-20231014174003391</figcaption>
</figure>
<h2 id="filter-basename-filter-out">filter, basename , filter-out</h2>
<p>继续沿用dir和not-dir的例子</p>
<p>如果有很多的文件,,然后我们要取出特定格式的</p>
<pre><code> $(filter 要筛选出的样式,来源) </code></pre>
<p>然后我们可以利用filter做一个结果的筛选,而不是替换什么的</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find /usr/lib -name lib*</span><span class="ch">)</span><span class="st"> </span><span class="co">#输出 所有的path/file</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">:=$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIBS</span><span class="ch">))</span><span class="st">  </span><span class="co">#输出所有的 file</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS_a</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">filter</span><span class="st"> %.a</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">LIBS</span><span class="ch">))</span><span class="st"> </span><span class="co">#输出所有静态库</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS_so</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">filter</span><span class="st"> %.so</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">LIBS</span><span class="ch">))</span><span class="st"> </span><span class="co">#输出所有动态库</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">LIBS_a</span><span class="ch">)</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">LIBS_so</span><span class="ch">)</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">debug  </span></span></code></pre></div>
<p>有时候,,对于file,,我只需要取出它的文件名,而不是后缀名</p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find /usr/lib -name lib*</span><span class="ch">)</span><span class="st"> </span><span class="co">#输出 所有的path/file</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">:=$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIBS</span><span class="ch">))</span><span class="st">  </span><span class="co">#输出所有的 file</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS_a</span>  <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$(</span><span class="kw">filter</span><span class="st"> %.a</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="dt">LIBS</span><span class="ch">)))</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS_so</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$(</span><span class="kw">filter</span><span class="st"> %.so</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">LIBS</span><span class="ch">)))</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="dv">liba:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">LIBS_a</span><span class="ch">)</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="dv">libso:</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">LIBS_so</span><span class="ch">)</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt">liba libso</span></span></code></pre></div>
<p>当然我们也可以利用subst,吧后缀名给置空</p>
<p>然后说说fileter-out是什么意思</p>
<p>比如我们有下面这个情况</p>
<pre><code>.
├── build
│   └── main.elf
├── include
│   ├── add.h
│   └── sub.h
├── makefile
├── obj
│   ├── add.o
│   ├── main.o
│   └── sub.o
└── src
    ├── add.c
    ├── main.c
    └── sub.c</code></pre>
<p>我们准备把add.c和sub.c编译为动态链接库</p>
<p>所以在取出.c文件中</p>
<p>我们不想拿出main.c</p>
<p>于是就这样</p>
<pre><code>SRCS :=$(filter-out src/main.c,$(shell find src -name *.c))</code></pre>
<p>输出</p>
<pre><code>redqx@Debian12:/mnt/hgfs/share/demo$ make debug
src/add.c src/sub.c</code></pre>
<h2 id="section-5">$(%)</h2>
<p>$(library_path:%=-Wl,-rpath=%)</p>
<p>意思是取出<code>library_path</code>的成员</p>
<p><code>%</code>代指得成员</p>
<p>然后替换为样式<code>-Wl,-rpath=%</code></p>
<h1 id="进入正题">进入正题</h1>
<p>比如我们有这样一个main.c</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;hello world</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>结构如下</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ tree
.
├── build
│   └── main.elf
├── makefile
├── objs
│   └── main.o
└── src
    └── main.c

3 directories, 4 file</code></pre>
<p>然后写一个makefle</p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span> <span class="ch">:=$(</span><span class="kw">shell</span><span class="st"> find src -name *.c</span><span class="ch">)</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">:=$(</span><span class="kw">patsubst</span><span class="st"> src/%.c</span><span class="kw">,</span><span class="st">objs/%.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">))</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="dt">BIN</span> <span class="ch">:=</span><span class="st"> build/main.elf</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="dv">objs/%.o :</span><span class="dt"> src/%.c</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">mkdir -p </span><span class="ch">$(</span><span class="kw">dir</span><span class="st"> </span><span class="ch">$@)</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">gcc -c </span><span class="ch">$&lt;</span><span class="fu"> -o </span><span class="ch">$@</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="dv">$(BIN):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">mkdir -p </span><span class="ch">$(</span><span class="kw">dir</span><span class="st"> </span><span class="ch">$@)</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">gcc </span><span class="ch">$^</span><span class="fu"> -o </span><span class="ch">$@</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">BIN</span><span class="ch">)</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">rm -rf objs build</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">)</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt"> clean</span></span></code></pre></div>
<h1 id="gcc-一些编译选项">gcc 一些编译选项</h1>
<p>了解即可,,用熟了自然就记住了</p>
<blockquote>
<p>编译选项</p>
</blockquote>
<ul>
<li><code>-m64</code>: 指定编译为 64 位应用程序</li>
<li><code>-std=</code>: 指定编译标准，例如：-std=c++11、-std=c++14</li>
<li><code>-g</code>: 包含调试信息</li>
<li><code>-w</code>: 不显示警告</li>
<li><code>-O</code>: 优化等级，通常使用：-O3</li>
<li><code>-I</code>: 加在头文件路径前</li>
<li><code>fPIC</code>: (Position-Independent Code),
产生的没有绝对地址，全部使用相对地址，代码可以被加载到内存的任意位置，且可以正确的执行。这正是共享库所要求的，共享库被加载时，在内存的位置不是固定的</li>
</ul>
<blockquote>
<p>链接选项</p>
</blockquote>
<ul>
<li><code>-l</code>: 加在库名前面</li>
<li><code>-L</code>: 加在库路径前面</li>
<li><code>-Wl,&lt;选项&gt;</code>: 将逗号分隔的 <选项> 传递给链接器</li>
<li><code>-rpath=</code>: “运行” 的时候，去找的目录。运行的时候，要找
.so 文件，会从这个选项里指定的地方去找</li>
</ul>
<p> </p>
<p>其中要注意的是</p>
<p>编译时,是gcc -c,需要指明头文件的路径</p>
<p>链接时,是gcc , 需要指明链接库名字,链接库的位置</p>
<h1 id="带头文件的编译">带头文件的编译</h1>
<p>结构如下</p>
<pre><code>redqx@DebianYY:/mnt/hgfs/share/demo$ tree
.
├── build
│   └── main.elf
├── include
│   ├── add.h
│   └── sub.h
├── makefile
├── obj
│   ├── add.o
│   ├── main.o
│   └── sub.o
└── src
    ├── add.c
    ├── main.c
    └── sub.c

4 directories, 10 files</code></pre>
<p>具体情况见<code>./demo</code>文件夹</p>
<p>makefile</p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span> <span class="ch">:=$(</span><span class="kw">shell</span><span class="st"> find src -name *.c</span><span class="ch">)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span> <span class="ch">:=$(</span><span class="kw">patsubst</span><span class="st"> src/%.c</span><span class="kw">,</span><span class="st">obj/%.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">))</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="dt">include_path</span> <span class="ch">:=</span><span class="st"> /mnt/hgfs/share/demo/include</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="dt">INCS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">include_path</span><span class="kw">:</span><span class="ss">%</span><span class="kw">=</span><span class="ss">-I%</span><span class="ch">)</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="dt">BIN</span> <span class="ch">:=</span><span class="st"> build/main.elf</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="dt">LDFALG</span> <span class="ch">:=</span><span class="st"> -g -O3 -w </span><span class="ch">$(</span><span class="dt">INCS</span><span class="ch">)</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="dv">obj/%.o :</span><span class="dt"> src/%.c</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">mkdir -p </span><span class="ch">$(</span><span class="kw">dir</span><span class="st"> </span><span class="ch">$@)</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">gcc -c </span><span class="ch">$&lt;</span><span class="fu"> </span><span class="ch">$(</span><span class="dt">LDFALG</span><span class="ch">)</span><span class="fu"> -o </span><span class="ch">$@</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="dv">$(BIN):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">mkdir -p </span><span class="ch">$(</span><span class="kw">dir</span><span class="st"> </span><span class="ch">$@)</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">gcc </span><span class="ch">$^</span><span class="fu"> -o </span><span class="ch">$@</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">BIN</span><span class="ch">)</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">rm -rf obj build</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">)</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">INCS</span><span class="ch">)</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">LDFALG</span><span class="ch">)</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY</span> <span class="ot">:</span><span class="dt"> clean</span></span></code></pre></div>
<p>其中,,,比较有意思</p>
<p>头文件的使用是放在CFLAG那里,而不是LDFALG</p>
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

</body>
</html>
